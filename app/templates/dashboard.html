{% extends "base.html" %}

{% block content %}
<div class="flex flex-col items-center w-full gap-6">

  {% if selected_location %}
  <div class="relative inline-block border-2 border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800/50 shadow-lg overflow-hidden"
       style="width: {{ selected_location.columns * selected_location.cell_size }}px;
              height: {{ selected_location.rows * selected_location.cell_size }}px;">

    {# Draw the grid lines #}
    {% for y in range(selected_location.rows) %}
      {% for x in range(selected_location.columns) %}
        <div class="absolute border-r border-b border-gray-200 dark:border-gray-700"
             style="left: {{ x * selected_location.cell_size }}px;
                    top: {{ y * selected_location.cell_size }}px;
                    width: {{ selected_location.cell_size }}px;
                    height: {{ selected_location.cell_size }}px;">
        </div>
      {% endfor %}
    {% endfor %}

    {# Place the games #}
    {% for game in games %}
      <div class="absolute text-center"
           style="left: {{ (game.x - 1) * selected_location.cell_size }}px;
                  top: {{ (game.y - 1) * selected_location.cell_size }}px;
                  width: {{ selected_location.cell_size }}px;
                  height: {{ selected_location.cell_size }}px;">
        <div class="h-full flex flex-col justify-center items-center cursor-pointer p-1"
             hx-get="/game/{{ game.id }}/modal"
             hx-target="#modal-container"
             hx-trigger="click"
             hx-swap="innerHTML">

          <img
            src="{{ '/static/images/' ~ game.icon if game.icon else '/static/default.png' }}"
            style="max-width: {{ selected_location.cell_size / 2 }}px; max-height: {{ selected_location.cell_size / 2 }}px;"
            class="mb-1 object-contain"
            alt="{{ game.name }}">

          <span class="text-xs font-semibold block text-center px-2 py-0.5 rounded-full
                bg-white/80 dark:bg-gray-900/80 text-black dark:text-white shadow-sm">
            {{ game.name }}
          </span>

          <span class="mt-1 text-xs font-medium block text-center px-2 py-0.5 rounded-full shadow-sm
                {{ status_classes(game.status) }}">
            {{ game.status.value.replace('_', ' ') | title }}
          </span>

        </div>
      </div>
    {% endfor %}

  </div>
  {% else %}
    <div class="text-center p-10 bg-white dark:bg-gray-800 rounded-lg shadow">
        <p class="text-gray-500">No location selected or available. Please create one in the settings.</p>
    </div>
  {% endif %}

</div>

<div id="modal-container"></div>

{% endblock %}