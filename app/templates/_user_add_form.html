{% if error %}
<div class="p-3 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400" role="alert">
  <span class="font-medium">Error:</span> {{ error }}
</div>
{% endif %}

<form
  id="add-user-form"
  hx-post="/settings/user/add"
  hx-target="#add-user-form-wrapper"
  hx-swap="innerHTML"
  class="space-y-4"
  novalidate>

  <div>
    <label for="name" class="block text-sm font-medium">Name</label>
    <input type="text" name="name" id="name" required value="{{ name or '' }}"
           class="mt-1 w-full border rounded px-2 py-1 dark:bg-gray-800 dark:border-gray-600">
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label for="pin" class="block text-sm font-medium">4-digit PIN</label>
      <input type="password" name="pin" id="pin" required maxlength="4" inputmode="numeric" autocomplete="new-password"
             class="mt-1 w-full border rounded px-2 py-1 dark:bg-gray-800 dark:border-gray-600">
      <span id="pin-error" class="text-red-500 text-sm mt-1 block h-4"></span>
    </div>

    <div>
      <label for="role" class="block text-sm font-medium">Role</label>
      <select name="role" id="role" required
              class="mt-1 w-full border rounded px-2 py-1 dark:bg-gray-800 dark:border-gray-600">
        {% for r in roles %}
          <option value="{{ r.value }}" {% if role == r.value %}selected{% endif %}>{{ r.name | title }}</option>
        {% endfor %}
      </select>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label for="email" class="block text-sm font-medium">Email (optional)</label>
      <input type="email" name="email" id="email" value="{{ email or '' }}"
             class="mt-1 w-full border rounded px-2 py-1 dark:bg-gray-800 dark:border-gray-600">
    </div>
    <div>
      <label for="phone" class="block text-sm font-medium">Phone (optional)</label>
      <input type="tel" name="phone" id="phone" value="{{ phone or '' }}"
             class="mt-1 w-full border rounded px-2 py-1 dark:bg-gray-800 dark:border-gray-600">
    </div>
  </div>

  <label class="inline-flex items-center gap-2">
    <input type="checkbox" name="notify" value="1" {% if notify %}checked{% endif %} class="h-4 w-4">
    <span>Notify when games break</span>
  </label>

  <div class="flex justify-end gap-4 pt-4">
    <button type="button"
            hx-get="/settings/modal"
            hx-target="#modal-container"
            class="bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-black dark:text-white font-bold py-2 px-4 rounded">
      Cancel
    </button>
    <button type="submit"
            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
      Create user
    </button>
  </div>
</form>

<script>
(function() {
  const form = document.getElementById('add-user-form');
  const pinInput = document.getElementById('pin');
  const pinError = document.getElementById('pin-error');

  form.addEventListener('submit', function(event) {
    // Clear any previous error message on new submission attempt
    pinError.textContent = '';

    // Check if the PIN field is empty
    if (pinInput.value.trim() === '') {
      // Prevent the form from submitting
      event.preventDefault();
      // Display the error message
      pinError.textContent = 'PIN cannot be empty.';
    }
  });
})();
</script>